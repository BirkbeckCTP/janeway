{% extends "admin/core/base.html" %}
{% load static from staticfiles %}
{% load foundation %}
{% load truncate %}

{% block title %}Article Workflow Manager{% endblock %}
{% block title-section %}Article Workflow Manager{% endblock %}
{% block title-sub %}{{ article.title|safe   }}{% endblock %}

{% block breadcrumbs %}
    {{ block.super }}
    <li><a href="{% url 'core_manager_index' %}">Manager</a></li>
    <li><a href="">#{{ article.pk }} {{ article.title|safe|truncatesmart }}</a></li>
    <li>Article Workflow Manager</li>
{% endblock %}

{% block body %}
    <div class="box">
        <div class="row expanded">
            <div class="large-9 columns">
                <p>
                    {% blocktrans %}
                        This tool should be used with extreme caution.
                        Once an article is moved back and forth along the workflow,
                        it has to be manually moved again.
                    {% endblocktrans %}
                </p>

                <form method="POST">
                    {% csrf_token %}
                    <table>
                        <tr>
                            <th>Stage</th>
                            <th>History</th>
                            <th></th>
                        </tr>
                        {% for element in journal.workflow.elements.all %}
                            <tr>
                                <td>{{ element.element_name|capfirst }}</td>
                                <td>
                                    {% if element in article.workflow_element_history %}
                                        {{ article.workflow_stages.last.timestamp }}
                                    {% endif %}
                                </td>
                                <td>
                                    {% if article.stage in element.stages %}
                                        {% trans 'Current Stage' %}
                                    {% else %}
                                        <button class="small warning button" name="stage_to" value="{{ element.stage }}">
                                            {% trans 'Move' %}
                                        </button>
                                    {% endif %}
                                </td>
                            </tr>
                        {% endfor %}
                    </table>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
